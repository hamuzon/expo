<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Expo Countdown</title>
<meta name="description" content="国際博覧会(万博)の開催日数カウント" />
<link rel="icon" href="icon.png" type="image/png" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron&family=Roboto&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    font-family:'Roboto',sans-serif; color:#e0f7fa;
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:1rem;
  }
  .container {
    background: rgba(255,255,255,0.07);
    border-radius:24px; padding:3rem 4rem; max-width:420px; width:100%;
    box-shadow:0 0 20px rgba(0,229,255,0.5); text-align:center; position:relative;
  }
  h1 { font-family:'Orbitron',sans-serif; font-size:2.8rem; color:#00e5ff;
       text-shadow:0 0 8px #00e5ff,0 0 20px #00e5ff; margin-bottom:0.3rem; }
  h2 { font-family:'Orbitron',sans-serif; font-size:1.1rem; color:#80deea; letter-spacing:0.15em; margin-bottom:1rem; }
  #dayDisplay { font-size:2.5rem; font-weight:700; color:#00fff7; text-shadow:0 0 5px #00fff7,0 0 15px #00fff7; margin-bottom:1rem; }
  #hourDisplay,#remainDisplay { font-size:1.2rem; font-weight:500; color:#80deea; margin-bottom:1rem; letter-spacing:0.05em; }
  #remainDisplay { margin-bottom:1.5rem; }
  .footer { font-size:0.9rem; color:#4dd0e1; letter-spacing:0.1em; user-select:none; }
  .lang-toggle, .year-link, .toggle-format {
    background: rgba(0,229,255,0.15); border:none; border-radius:20px; color:#00e5ff;
    font-weight:600; padding:6px 14px; cursor:pointer; font-family:'Roboto',sans-serif; transition:0.3s;
    margin:0 4px; 
  }
  .lang-toggle:hover, .year-link:hover, .toggle-format:hover { background: rgba(0,229,255,0.3); }
  .year-links { margin-bottom:1rem; display:flex; justify-content:center; flex-wrap:wrap; }
  .year-link.active { background:#00e5ff; color:#0f2027; font-weight:700; }
  @media(max-width:480px){
    .container{padding:2rem 2rem; max-width:320px;}
    h1{font-size:2rem;}#dayDisplay{font-size:2rem;margin-bottom:1rem;}
    #hourDisplay,#remainDisplay{font-size:1rem;margin-bottom:1rem;}
    h2{font-size:1rem;margin-bottom:1rem;}
  }
</style>
</head>
<body>
<div class="container" role="main" aria-live="polite">
  <div class="year-links">
    <button class="year-link" id="btn-2025" onclick="switchYear('2025')">2025</button>
    <button class="year-link" id="btn-2027" onclick="switchYear('2027')">2027</button>
    <button class="year-link" id="btn-2030" onclick="switchYear('2030')">2030</button>
    <button class="lang-toggle" aria-label="Toggle Language">EN</button>
    <button class="toggle-format" onclick="toggleDayFormat()">切替</button>
  </div>
  <h1 id="title">読み込み中…</h1>
  <h2 id="subtitle"></h2>
  <p id="dayDisplay">読み込み中…</p>
  <p id="hourDisplay"></p>
  <p id="remainDisplay"></p>
  <div class="footer" id="footer"></div>
</div>

<script>
let year = window.location.pathname.replace("/","") || "2025";
let lang='jp';
let showDayCount = true; // true=日目, false=年月日

const expoDates = {
  "2025": { start: "2025-04-13T00:00:00+09:00", end: "2025-10-13T00:00:00+09:00" },
  "2027": { start: "2027-04-01T00:00:00+09:00", end: "2027-07-01T00:00:00+09:00" },
  "2030": { start: "2030-04-01T00:00:00+03:00", end: "2030-10-01T00:00:00+03:00" }
};

const expoTitles = {
  "2025": { jp:"2025 日本万博", en:"Expo 2025 Japan" },
  "2027": { jp:"2027 横浜万博", en:"Expo 2027 Yokohama" },
  "2030": { jp:"2030 リヤド万博", en:"Expo 2030 Riyadh" }
};

const dayDisplay = document.getElementById("dayDisplay");
const hourDisplay = document.getElementById("hourDisplay");
const remainDisplay = document.getElementById("remainDisplay");
const titleEl = document.getElementById("title");
const subtitleEl = document.getElementById("subtitle");
const footerEl = document.getElementById("footer");
const langToggleBtn = document.querySelector(".lang-toggle");
const toggleBtn = document.querySelector(".toggle-format");

const texts = {
  jp:{ subtitle:"開催からの経過日数カウント", loading:"読み込み中…", toggle:"切替"},
  en:{ subtitle:"Days Since Opening", loading:"Loading...", toggle:"Toggle"}
};

function formatRemaining(ms){
  const d=Math.floor(ms/(1000*60*60*24));
  const h=Math.floor((ms%(1000*60*60*24))/(1000*60*60));
  const m=Math.floor((ms%(1000*60*60))/(1000*60));
  const s=Math.floor((ms%(1000*60))/1000);
  return {d,h,m,s};
}

function msToYMD(ms){
  const totalDays = Math.floor(ms / (1000*60*60*24));
  const years = Math.floor(totalDays/365);
  const months = Math.floor((totalDays%365)/30);
  const days = totalDays - years*365 - months*30;
  return {years, months, days};
}

function updateDay(){
  const now = new Date();
  const utc = now.getTime() + (now.getTimezoneOffset()*60000);
  const expoOffset = (year==="2030"?3:9)*60*60*1000;
  const localTime = new Date(utc + expoOffset);

  const startDate = new Date(expoDates[year].start);
  const endDate = new Date(expoDates[year].end);

  // 切替ボタン表示制御
  if(localTime < startDate || localTime > endDate){
    toggleBtn.style.display = "none";
  } else {
    toggleBtn.style.display = "inline-block";
    toggleBtn.textContent = (lang==='jp') ? texts.jp.toggle : texts.en.toggle;
  }

  if(localTime < startDate){
    const {years, months, days} = msToYMD(startDate-localTime);
    dayDisplay.textContent = (lang==='jp')? `開催まで ${years}年${months}ヶ月${days}日` : `Starts in ${years}y ${months}m ${days}d`;
    const {h,m,s} = formatRemaining(startDate-localTime);
    hourDisplay.textContent = `${h}h ${m}m ${s}s`;
    remainDisplay.textContent = "";
  }
  else if(localTime > endDate){
    const {years, months, days} = msToYMD(localTime-endDate);
    dayDisplay.textContent = (lang==='jp')? `終了から ${years}年${months}ヶ月${days}日` : `Since closing: ${years}y ${months}m ${days}d`;
    const {h,m,s} = formatRemaining(localTime-endDate);
    hourDisplay.textContent = `${h}h ${m}m ${s}s`;
    remainDisplay.textContent = "";
  }
  else{
    const diffMs = localTime-startDate;
    const diffDays = Math.floor(diffMs/(1000*60*60*24))+1;

    if(showDayCount){
      dayDisplay.textContent = (lang==='jp')? `今日は万博の ${diffDays} 日目` : `Today is day ${diffDays} of the Expo`;
    } else {
      const {years, months, days} = msToYMD(diffMs);
      dayDisplay.textContent = (lang==='jp')? `開催から ${years}年${months}ヶ月${days}日` 
                                        : `Time since opening: ${years}y ${months}m ${days}d`;
    }

    const {d,h,m,s} = formatRemaining(diffMs);
    hourDisplay.textContent = `経過: ${d}d ${h}h ${m}m ${s}s`;
    const remain = formatRemaining(endDate-localTime);
    remainDisplay.textContent = `残り: ${remain.d}d ${remain.h}h ${remain.m}m ${remain.s}s`;
  }
}

function updateTexts(){
  titleEl.textContent = expoTitles[year][lang];
  subtitleEl.textContent = texts[lang].subtitle;
  footerEl.textContent = `開催期間: ${expoDates[year].start.split("T")[0]} ～ ${expoDates[year].end.split("T")[0]}`;
  langToggleBtn.textContent = (lang==='jp')? 'EN' : 'JP';
  updateYearButtons();
}

function toggleLanguage(){
  lang = (lang==='jp')?'en':'jp';
  updateTexts();
  updateDay();
}

function toggleDayFormat(){
  showDayCount = !showDayCount;
  updateDay();
}

function updateYearButtons(){
  ['2025','2027','2030'].forEach(y=>{
    const btn = document.getElementById('btn-'+y);
    if(y === year) btn.classList.add('active');
    else btn.classList.remove('active');
  });
}

function switchYear(y){
  year=y;
  history.replaceState(null,null,'/'+y);
  updateTexts();
  updateDay();
}

langToggleBtn.addEventListener('click',toggleLanguage);

dayDisplay.textContent = texts[lang].loading;
updateTexts();
updateDay();
setInterval(updateDay,1000);
</script>
</body>
</html>